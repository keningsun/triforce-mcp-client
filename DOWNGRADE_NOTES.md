# Next.js 降级到 13.2.4 版本的说明

## 降级原因

降级到 Next.js 13.2.4 版本是为了解决生产环境中出现的 HTTP 方法处理问题，特别是`/api/auth/_log`路由返回 405 错误的问题。这个问题会导致认证流程无法完成，即使成功创建认证器记录，会话状态也无法正确保存。

## 已执行的更改

1. 将 Next.js 从 14.2.15 降级到 13.2.4
2. 删除了 App Router 中的`/app/api/auth/_log/route.ts`文件
3. 在 Pages Router 中创建了`/pages/api/auth/_log.ts`文件
4. 更新了中间件配置，确保不拦截`/api/auth/_log`路由
5. 简化了 Next.js 配置文件中的实验性特性

## 部署后测试步骤

1. 访问登录页面
2. 尝试注册新用户
3. 验证注册流程是否成功
4. 尝试使用新创建的账户登录
5. 验证登录流程是否成功
6. 检查生产环境日志，确认不再有 405 错误

## 注意事项

- 如果降级后出现任何新问题，请检查是否与 Next.js 版本变更相关
- 特别留意 App Router 和 Pages Router 路由的区别
- 确保所有 API 端点在新版本中正常工作
- 监控生产环境日志，确认错误已被解决

## 降级脚本使用方法

运行以下命令执行降级过程：

```bash
./downgrade.sh
```

脚本将自动执行以下步骤：

- 安装 Next.js 13.2.4 版本
- 清理缓存和构建文件
- 重新安装依赖
- 重新构建项目

执行完成后，请手动部署到 Vercel。
